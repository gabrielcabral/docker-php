(function(e){var b=(window.orientation!=undefined),a=((e.browser.opera||(e.browser.mozilla&&parseFloat(e.browser.version.substr(0,3))<1.9))?"input":"paste"),d=(e.browser.msie?"paste":"input")+".mask";console.log(a,d);e.event.special.paste={setup:function(){if(this.addEventListener){this.addEventListener(a,c,false)}else{if(this.attachEvent){this.attachEvent(a,c)}}},teardown:function(){if(this.removeEventListener){this.removeEventListener(a,c,false)}else{if(this.detachEvent){this.detachEvent(a,c)}}}};function c(g){var f=this;g=e.event.fix(g||window.e);g.type="paste";setTimeout(function(){e.event.handle.call(f,g)},1)}e.extend({mask:{rules:{z:/[a-z]/,Z:/[A-Z]/,a:/[a-zA-Z]/,"*":/[0-9a-zA-Z]/,"@":/[0-9a-zA-ZÃ§Ã‡Ã¡Ã Ã£Ã¢Ã©Ã¨ÃªÃÃ¬Ã³Ã²Ã´ÃµÃºÃ¹Ã¼]/},keyRepresentation:{8:"backspace",9:"tab",13:"enter",16:"shift",17:"control",18:"alt",27:"esc",33:"page up",34:"page down",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",116:"f5",123:"f12",224:"command"},iphoneKeyRepresentation:{10:"go",127:"delete"},signals:{"+":"","-":"-"},options:{attr:"alt",mask:null,type:"fixed",maxLength:-1,defaultValue:"",signal:false,textAlign:true,selectCharsOnFocus:true,autoTab:true,setSize:false,fixedChars:"[(),.:/ -]",onInvalid:function(){},onValid:function(){},onOverflow:function(){}},masks:{phone:{mask:"(99) 9999-9999"},"phone-us":{mask:"(999) 999-9999"},cpf:{mask:"999.999.999-99"},cnpj:{mask:"99.999.999/9999-99"},date:{mask:"39/19/9999"},"date-us":{mask:"19/39/9999"},cep:{mask:"99999-999"},time:{mask:"29:59"},cc:{mask:"9999 9999 9999 9999"},integer:{mask:"999.999.999.999",type:"reverse"},decimal:{mask:"99,999.999.999.999",type:"reverse",defaultValue:"000"},"decimal-us":{mask:"99.999,999,999,999",type:"reverse",defaultValue:"000"},"signed-decimal":{mask:"99,999.999.999.999",type:"reverse",defaultValue:"+000"},"signed-decimal-us":{mask:"99,999.999.999.999",type:"reverse",defaultValue:"+000"}},init:function(){if(!this.hasInit){var f=this,g,h=(b)?this.iphoneKeyRepresentation:this.keyRepresentation;this.ignore=false;for(g=0;g<=9;g++){this.rules[g]=new RegExp("[0-"+g+"]")}this.keyRep=h;this.ignoreKeys=[];e.each(h,function(i){f.ignoreKeys.push(parseInt(i))});this.hasInit=true}},set:function(j,h){var f=this,g=e(j),i="maxLength";h=h||{};this.init();return g.each(function(){if(h.attr){f.options.attr=h.attr}var p=e(this),r=e.extend({},f.options),s=p.attr(r.attr),n="";n=(typeof h=="string")?h:(s!="")?s:null;if(n){r.mask=n}if(f.masks[n]){r=e.extend(r,f.masks[n])}if(typeof h=="object"&&h.constructor!=Array){r=e.extend(r,h)}if(e.metadata){r=e.extend(r,p.metadata())}if(r.mask!=null){if(p.data("mask")){f.unset(p)}var m=r.defaultValue,k=(r.type=="reverse"),l=new RegExp(r.fixedChars,"g");if(r.maxLength==-1){r.maxLength=p.attr(i)}r=e.extend({},r,{fixedCharsReg:new RegExp(r.fixedChars),fixedCharsRegG:l,maskArray:r.mask.split(""),maskNonFixedCharsArray:r.mask.replace(l,"").split("")});if((r.type=="fixed"||k)&&r.setSize&&!p.attr("size")){p.attr("size",r.mask.length)}if(k&&r.textAlign){p.css("text-align","right")}if(this.value!=""||m!=""){var q=f.string((this.value!="")?this.value:m,r);this.defaultValue=q;p.val(q)}if(r.type=="infinite"){r.type="repeat"}p.data("mask",r);p.removeAttr(i);p.bind("keydown.mask",{func:f._onKeyDown,thisObj:f},f._onMask).bind("keypress.mask",{func:f._onKeyPress,thisObj:f},f._onMask).bind("keyup.mask",{func:f._onKeyUp,thisObj:f},f._onMask).bind("paste.mask",{func:f._onPaste,thisObj:f},f._onMask).bind("focus.mask",f._onFocus).bind("focus",f._onFocus).bind("blur.mask",f._onBlur).bind("change.mask",f._onChange).bind(d,{func:f._onPaste,thisObj:f},f._onMask)}})},unset:function(g){var f=e(g);return f.each(function(){var i=e(this);if(i.data("mask")){var h=i.data("mask").maxLength;if(h!=-1){i.attr("maxLength",h)}i.unbind(".mask").removeData("mask")}})},string:function(j,f){this.init();var i={};if(typeof j!="string"){j=String(j)}switch(typeof f){case"string":if(this.masks[f]){i=e.extend(i,this.masks[f])}else{i.mask=f}break;case"object":i=f}if(!i.fixedChars){i.fixedChars=this.options.fixedChars}var h=new RegExp(i.fixedChars),g=new RegExp(i.fixedChars,"g");if((i.type=="reverse")&&i.defaultValue){if(typeof this.signals[i.defaultValue.charAt(0)]!="undefined"){var k=j.charAt(0);i.signal=(typeof this.signals[k]!="undefined")?this.signals[k]:this.signals[i.defaultValue.charAt(0)];i.defaultValue=i.defaultValue.substring(1)}}return this.__maskArray(j.split(""),i.mask.replace(g,"").split(""),i.mask.split(""),i.type,i.maxLength,i.defaultValue,h,i.signal)},_onFocus:function(h){var g=e(this),f=g.data("mask");f.inputFocusValue=g.val();f.changed=false;if(f.selectCharsOnFocus){g.select()}},_onBlur:function(h){var g=e(this),f=g.data("mask");if(f.inputFocusValue!=g.val()&&!f.changed){g.trigger("change")}},_onChange:function(f){e(this).data("mask").changed=true},_onMask:function(f){var h=f.data.thisObj,g={};g._this=f.target;g.$this=e(g._this);if(g.$this.attr("readonly")){return true}g.data=g.$this.data("mask");g[g.data.type]=true;g.value=g.$this.val();g.nKey=h.__getKeyNumber(f);g.range=h.__getRange(g._this);g.valueArray=g.value.split("");return f.data.func.call(h,f,g)},_onKeyDown:function(g,h){this.ignore=e.inArray(h.nKey,this.ignoreKeys)>-1||g.ctrlKey||g.metaKey||g.altKey;if(this.ignore){var f=this.keyRep[h.nKey];h.data.onValid.call(h._this,f?f:"",h.nKey)}return b?this._keyPress(g,h):true},_onKeyUp:function(f,g){if(g.nKey==9||g.nKey==16){return true}if(g.data.type=="repeat"){this.__autoTab(g);return true}return this._onPaste(f,g)},_onPaste:function(g,h){if(h.reverse){this.__changeSignal(g.type,h)}var f=this.__maskArray(h.valueArray,h.data.maskNonFixedCharsArray,h.data.maskArray,h.data.type,h.data.maxLength,h.data.defaultValue,h.data.fixedCharsReg,h.data.signal);h.$this.val(f);if(!h.reverse&&h.data.defaultValue.length&&(h.range.start==h.range.end)){this.__setRange(h._this,h.range.start,h.range.end)}if((e.browser.msie||e.browser.safari)&&!h.reverse){this.__setRange(h._this,h.range.start,h.range.end)}if(this.ignore){return true}this.__autoTab(h);return true},_onKeyPress:function(m,f){if(this.ignore){return true}if(f.reverse){this.__changeSignal(m.type,f)}var n=String.fromCharCode(f.nKey),q=f.range.start,i=f.value,l=f.data.maskArray;if(f.reverse){var h=i.substr(0,q),g=i.substr(f.range.end,i.length);i=h+n+g;if(f.data.signal&&(q-f.data.signal.length>0)){q-=f.data.signal.length}}var p=i.replace(f.data.fixedCharsRegG,"").split(""),k=this.__extraPositionsTill(q,l,f.data.fixedCharsReg);f.rsEp=q+k;if(f.repeat){f.rsEp=0}if(!this.rules[l[f.rsEp]]||(f.data.maxLength!=-1&&p.length>=f.data.maxLength&&f.repeat)){f.data.onOverflow.call(f._this,n,f.nKey);return false}else{if(!this.rules[l[f.rsEp]].test(n)){f.data.onInvalid.call(f._this,n,f.nKey);return false}else{f.data.onValid.call(f._this,n,f.nKey)}}var j=this.__maskArray(p,f.data.maskNonFixedCharsArray,l,f.data.type,f.data.maxLength,f.data.defaultValue,f.data.fixedCharsReg,f.data.signal,k);f.$this.val(j);return(f.reverse)?this._keyPressReverse(m,f):(f.fixed)?this._keyPressFixed(m,f):true},_keyPressFixed:function(f,g){if(g.range.start==g.range.end){if((g.rsEp==0&&g.value.length==0)||g.rsEp<g.value.length){this.__setRange(g._this,g.rsEp,g.rsEp+1)}}else{this.__setRange(g._this,g.range.start,g.range.end)}return true},_keyPressReverse:function(f,g){if(e.browser.msie&&((g.range.start==0&&g.range.end==0)||g.range.start!=g.range.end)){this.__setRange(g._this,g.value.length)}return false},__autoTab:function(g){if(g.data.autoTab&&((g.$this.val().length>=g.data.maskArray.length&&!g.repeat)||(g.data.maxLength!=-1&&g.valueArray.length>=g.data.maxLength&&g.repeat))){var f=this.__getNextInput(g._this,g.data.autoTab);if(f){g.$this.trigger("blur");f.focus().select()}}},__changeSignal:function(g,h){if(h.data.signal!==false){var f=(g=="paste")?h.value.charAt(0):String.fromCharCode(h.nKey);if(this.signals&&(typeof this.signals[f]!="undefined")){h.data.signal=this.signals[f]}}},__getKeyNumber:function(f){return(f.charCode||f.keyCode||f.which)},__maskArray:function(m,h,k,l,i,g,n,o,j){if(l=="reverse"){m.reverse()}m=this.__removeInvalidChars(m,h,l=="repeat"||l=="infinite");if(g){m=this.__applyDefaultValue.call(m,g)}m=this.__applyMask(m,k,j,n);switch(l){case"reverse":m.reverse();return(o||"")+m.join("").substring(m.length-k.length);case"infinite":case"repeat":var f=m.join("");return(i!=-1&&m.length>=i)?f.substring(0,i):f;default:return m.join("").substring(0,k.length)}return""},__applyDefaultValue:function(h){var j=h.length,g=this.length,f;for(f=g-1;f>=0;f--){if(this[f]==h.charAt(0)){this.pop()}else{break}}for(f=0;f<j;f++){if(!this[f]){this[f]=h.charAt(f)}}return this},__removeInvalidChars:function(j,g,f){for(var h=0,k=0;h<j.length;h++){if(g[k]&&this.rules[g[k]]&&!this.rules[g[k]].test(j[h])){j.splice(h,1);if(!f){k--}h--}if(!f){k++}}return j},__applyMask:function(h,g,k,j){if(typeof k=="undefined"){k=0}for(var f=0;f<h.length+k;f++){if(g[f]&&j.test(g[f])){h.splice(f,0,g[f])}}return h},__extraPositionsTill:function(f,h,i){var g=0;while(i.test(h[f++])){g++}return g},__getNextInput:function(p,g){var j=p.form.elements,h=e.inArray(p,j)+1,o=null,l;for(l=h;l<j.length;l++){o=e(j[l]);if(this.__isNextInput(o,g)){return o}}var f=document.forms,k=e.inArray(p.form,f)+1,n,m=null;for(n=k;n<f.length;n++){m=f[n].elements;for(l=0;l<m.length;l++){o=e(m[l]);if(this.__isNextInput(o,g)){return o}}}return null},__isNextInput:function(h,f){var g=h.get(0);return g&&(g.offsetWidth>0||g.offsetHeight>0)&&g.nodeName!="FIELDSET"&&(f===true||(typeof f=="string"&&h.is(f)))},__setRange:function(h,i,f){if(typeof f=="undefined"){f=i}if(h.setSelectionRange){h.setSelectionRange(i,f)}else{var g=h.createTextRange();g.collapse();g.moveStart("character",i);g.moveEnd("character",f-i);g.select()}},__getRange:function(g){if(!e.browser.msie){return{start:g.selectionStart,end:g.selectionEnd}}var h={start:0,end:0},f=document.selection.createRange();h.start=0-f.duplicate().moveStart("character",-100000);h.end=h.start+f.text.length;return h},unmaskedVal:function(f){return e(f).val().replace(e.mask.fixedCharsRegG,"")}}});e.fn.extend({setMask:function(f){return e.mask.set(this,f)},unsetMask:function(){return e.mask.unset(this)},unmaskedVal:function(){return e.mask.unmaskedVal(this[0])}})})(jQuery);